<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Enable LLM to call R functions (and/or MCP server tools) — answer_using_tools • tidyprompt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Enable LLM to call R functions (and/or MCP server tools) — answer_using_tools"><meta name="description" content="This function adds the ability for the a LLM to call R functions.
Users can specify a list of functions that the LLM can call, and the
prompt will be modified to include information, as well as an
accompanying extraction function to call the functions (handled by
send_prompt()). Documentation for the functions is extracted from
the help file (if available), or from documentation added by
tools_add_docs(). Users can also provide an 'ellmer' tool definition
(see ellmer::tool(); 'ellmer' documentation).
Model Context Protocol (MCP) tools from MCP servers, as returned from
mcptools::mcp_tools(), may also be used. Regardless of which type of
tool definition is provided, the function will work with both 'ellmer' and
regular LLM providers (the function converts between the two types as needed)."><meta property="og:description" content="This function adds the ability for the a LLM to call R functions.
Users can specify a list of functions that the LLM can call, and the
prompt will be modified to include information, as well as an
accompanying extraction function to call the functions (handled by
send_prompt()). Documentation for the functions is extracted from
the help file (if available), or from documentation added by
tools_add_docs(). Users can also provide an 'ellmer' tool definition
(see ellmer::tool(); 'ellmer' documentation).
Model Context Protocol (MCP) tools from MCP servers, as returned from
mcptools::mcp_tools(), may also be used. Regardless of which type of
tool definition is provided, the function will work with both 'ellmer' and
regular LLM providers (the function converts between the two types as needed)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_prompt_wraps.html">Creating prompt wraps</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/sentiment_analysis.html">Sentiment analysis in R with a LLM and 'tidyprompt'</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KennispuntTwente/tidyprompt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Enable LLM to call R functions (and/or MCP server tools)</h1>
      <small class="dont-index">Source: <a href="https://github.com/KennispuntTwente/tidyprompt/blob/0.2.0/R/answer_using_tools.R" class="external-link"><code>R/answer_using_tools.R</code></a></small>
      <div class="d-none name"><code>answer_using_tools.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function adds the ability for the a LLM to call R functions.
Users can specify a list of functions that the LLM can call, and the
prompt will be modified to include information, as well as an
accompanying extraction function to call the functions (handled by
<code><a href="send_prompt.html">send_prompt()</a></code>). Documentation for the functions is extracted from
the help file (if available), or from documentation added by
<code><a href="tools_add_docs.html">tools_add_docs()</a></code>. Users can also provide an 'ellmer' tool definition
(see <code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">ellmer::tool()</a></code>; <a href="https://ellmer.tidyverse.org/articles/tool-calling.html" class="external-link">'ellmer' documentation</a>).
Model Context Protocol (MCP) tools from MCP servers, as returned from
<code><a href="https://posit-dev.github.io/mcptools/reference/client.html" class="external-link">mcptools::mcp_tools()</a></code>, may also be used. Regardless of which type of
tool definition is provided, the function will work with both 'ellmer' and
regular LLM providers (the function converts between the two types as needed).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">answer_using_tools</span><span class="op">(</span></span>
<span>  <span class="va">prompt</span>,</span>
<span>  tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"openai"</span>, <span class="st">"ollama"</span>, <span class="st">"ellmer"</span>, <span class="st">"text-based"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-prompt">prompt<a class="anchor" aria-label="anchor" href="#arg-prompt"></a></dt>
<dd><p>A single string or a <code><a href="tidyprompt.html">tidyprompt()</a></code> object</p></dd>


<dt id="arg-tools">tools<a class="anchor" aria-label="anchor" href="#arg-tools"></a></dt>
<dd><p>An R function, an 'ellmer' tool definition (from <code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">ellmer::tool()</a></code>),
or a list of either, which the LLM will be able to call. If an R function is passed
which has been documented in a help file (e.g., because it is part of a package),
the documentation will be parsed from the help file. If it is a custom function,
documentation should be added with <code><a href="tools_add_docs.html">tools_add_docs()</a></code> or with <code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">ellmer::tool()</a></code>.
Note that you can also provide Model Context Protocol (MCP) tools from MCP servers
as returned from <code><a href="https://posit-dev.github.io/mcptools/reference/client.html" class="external-link">mcptools::mcp_tools()</a></code></p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>(optional) The way that tool calling should be enabled.
"auto" will automatically determine the type based on <code>llm_provider$api_type</code>
or 'llm_provider$tool_type' (if set; 'tool_type' overrides 'api_type' determination)
(note that this may not consider model compatibility, and could lead to errors;
set 'type' manually if errors occur). "openai" and "ollama" will set the
relevant API parameters. "ellmer" will register the tool in the 'ellmer' chat
object of the LLM provider; note that this will only work for an <code><a href="llm_provider_ellmer.html">llm_provider_ellmer()</a></code>
("auto" will always set the type to "ellmer" if you are using an 'ellmer' LLM provider).
"text-based" will provide function definitions in the prompt, extract function
calls from the LLM response, and call the
functions, providing the results back via <code><a href="llm_feedback.html">llm_feedback()</a></code>. "text-based"
always works, but may be inefficient for APIs that support tool calling
natively. Note that when using "openai", "ollama", or "ellmer", tool calls are not counted
as interactions by <code><a href="send_prompt.html">send_prompt()</a></code> and may continue indefinitely unless restricted
by other means</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="tidyprompt.html">tidyprompt()</a></code> with an added <code><a href="prompt_wrap.html">prompt_wrap()</a></code> which
will allow the LLM to call the given R functions when evaluating
the prompt with <code><a href="send_prompt.html">send_prompt()</a></code></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that conversion between 'tidyprompt' and 'ellmer' tool definitions
is experimntal and might contain bugs.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="answer_using_r.html">answer_using_r()</a></code> <code><a href="tools_get_docs.html">tools_get_docs()</a></code></p>
<p>Other pre_built_prompt_wraps:
<code><a href="add_text.html">add_text</a>()</code>,
<code><a href="answer_as_boolean.html">answer_as_boolean</a>()</code>,
<code><a href="answer_as_category.html">answer_as_category</a>()</code>,
<code><a href="answer_as_integer.html">answer_as_integer</a>()</code>,
<code><a href="answer_as_json.html">answer_as_json</a>()</code>,
<code><a href="answer_as_list.html">answer_as_list</a>()</code>,
<code><a href="answer_as_multi_category.html">answer_as_multi_category</a>()</code>,
<code><a href="answer_as_named_list.html">answer_as_named_list</a>()</code>,
<code><a href="answer_as_regex_match.html">answer_as_regex_match</a>()</code>,
<code><a href="answer_as_text.html">answer_as_text</a>()</code>,
<code><a href="answer_by_chain_of_thought.html">answer_by_chain_of_thought</a>()</code>,
<code><a href="answer_by_react.html">answer_by_react</a>()</code>,
<code><a href="answer_using_r.html">answer_using_r</a>()</code>,
<code><a href="answer_using_sql.html">answer_using_sql</a>()</code>,
<code><a href="prompt_wrap.html">prompt_wrap</a>()</code>,
<code><a href="quit_if.html">quit_if</a>()</code>,
<code><a href="set_system_prompt.html">set_system_prompt</a>()</code></p>
<p>Other answer_using_prompt_wraps:
<code><a href="answer_using_r.html">answer_using_r</a>()</code>,
<code><a href="answer_using_sql.html">answer_using_sql</a>()</code></p>
<p>Other tools:
<code><a href="tools_add_docs.html">tools_add_docs</a>()</code>,
<code><a href="tools_get_docs.html">tools_get_docs</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># When using functions from base R or R packages,</span></span></span>
<span class="r-in"><span><span class="co">#   documentation is automatically extracted from help files:</span></span></span>
<span class="r-in"><span><span class="va">prompt_with_dir_function</span> <span class="op">&lt;-</span> <span class="st">"What are the files in my current directory?"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">dir</span><span class="op">)</span> <span class="co"># The 'dir' function is from base R</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> <span style="font-weight: bold;">`answer_using_tools()`</span>:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Automatically determining type based on 'llm_provider$api_type';</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (or 'llm_provider$tool_type' if set); this does not consider model compatability</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Manually set argument 'type' if errors occur ("text-based" always works)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Use `options(tidyprompt.warn.auto.tools = FALSE)` to suppress this warning</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">prompt_with_dir_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   What are the files in my current directory?</span></span></span>
<span class="r-in"><span>  <span class="co">#   --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   Calling function 'nm' with arguments:</span></span></span>
<span class="r-in"><span>  <span class="co">#   {</span></span></span>
<span class="r-in"><span>  <span class="co">#     "all.files": true,</span></span></span>
<span class="r-in"><span>  <span class="co">#     "full.names": false,</span></span></span>
<span class="r-in"><span>  <span class="co">#     "ignore.case": false,</span></span></span>
<span class="r-in"><span>  <span class="co">#     "include.dirs": false,</span></span></span>
<span class="r-in"><span>  <span class="co">#     "no..": false,</span></span></span>
<span class="r-in"><span>  <span class="co">#     "path": "./",</span></span></span>
<span class="r-in"><span>  <span class="co">#     "pattern": "*",</span></span></span>
<span class="r-in"><span>  <span class="co">#     "recursive": false</span></span></span>
<span class="r-in"><span>  <span class="co">#   }</span></span></span>
<span class="r-in"><span>  <span class="co"># Result:</span></span></span>
<span class="r-in"><span>  <span class="co">#   .git, .github, .gitignore, .Rbuildignore, .Rhistory, ...</span></span></span>
<span class="r-in"><span>  <span class="co"># The files in your current directory are:</span></span></span>
<span class="r-in"><span>  <span class="co">#   .git, .github, .gitignore, .Rbuildignore, .Rhistory, ...</span></span></span>
<span class="r-in"><span>  <span class="co"># [1] "The files in your current directory are:\n\n .git, .github, ..."</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Users may provide custom functions in two ways:</span></span></span>
<span class="r-in"><span><span class="co">#   1) as a function object, optionally documented with `tools_get_docs()`, or</span></span></span>
<span class="r-in"><span><span class="co">#   2) as an 'ellmer' tool definition, using `ellmer::tool()`</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Take this fake weather function as an example:</span></span></span>
<span class="r-in"><span><span class="va">temperature_in_location</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">location</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amsterdam"</span>, <span class="st">"Utrecht"</span>, <span class="st">"Enschede"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">unit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Celcius"</span>, <span class="st">"Fahrenheit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">unit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">temperature_celcius</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">location</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Amsterdam"</span> <span class="op">=</span> <span class="fl">32.5</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Utrecht"</span> <span class="op">=</span> <span class="fl">19.8</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Enschede"</span> <span class="op">=</span> <span class="fl">22.7</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">unit</span> <span class="op">==</span> <span class="st">"Celcius"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">temperature_celcius</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">temperature_celcius</span> <span class="op">*</span> <span class="fl">9</span><span class="op">/</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">32</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1: `tools_add_docs()` --------------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate documentation for a function, based on formals &amp; help file</span></span></span>
<span class="r-in"><span><span class="va">docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="tools_get_docs.html">tools_get_docs</a></span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The types get inferred from the function's formals</span></span></span>
<span class="r-in"><span><span class="co"># However, descriptions are still missing as the function is not from a package</span></span></span>
<span class="r-in"><span><span class="co"># We can modify the documentation object to add descriptions:</span></span></span>
<span class="r-in"><span><span class="va">docs</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"Get the temperature in a location"</span></span></span>
<span class="r-in"><span><span class="va">docs</span><span class="op">$</span><span class="va">arguments</span><span class="op">$</span><span class="va">unit</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"Unit in which to return the temperature"</span></span></span>
<span class="r-in"><span><span class="va">docs</span><span class="op">$</span><span class="va">arguments</span><span class="op">$</span><span class="va">location</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"Location for which to return the temperature"</span></span></span>
<span class="r-in"><span><span class="va">docs</span><span class="op">$</span><span class="va">return</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"The temperature in the specified location and unit"</span></span></span>
<span class="r-in"><span><span class="co"># (See `?tools_add_docs` for more details on the structure of the documentation)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When we are satisfied with the documentation, we can add it to the function:</span></span></span>
<span class="r-in"><span><span class="va">temperature_in_location</span> <span class="op">&lt;-</span> <span class="fu"><a href="tools_add_docs.html">tools_add_docs</a></span><span class="op">(</span><span class="va">temperature_in_location</span>, <span class="va">docs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prompt_with_weather_function</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Enschede? Give me Celcius degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> <span style="font-weight: bold;">`answer_using_tools()`</span>:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Automatically determining type based on 'llm_provider$api_type';</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (or 'llm_provider$tool_type' if set); this does not consider model compatability</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Manually set argument 'type' if errors occur ("text-based" always works)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Use `options(tidyprompt.warn.auto.tools = FALSE)` to suppress this warning</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">prompt_with_weather_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   What is the weather in Enschede? Give me Celcius degrees</span></span></span>
<span class="r-in"><span>  <span class="co">#   --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   Calling function 'temperature_in_location' with arguments:</span></span></span>
<span class="r-in"><span>  <span class="co">#   {</span></span></span>
<span class="r-in"><span>  <span class="co">#     "location": "Enschede",</span></span></span>
<span class="r-in"><span>  <span class="co">#     "unit": "Celcius"</span></span></span>
<span class="r-in"><span>  <span class="co">#   }</span></span></span>
<span class="r-in"><span>  <span class="co"># Result:</span></span></span>
<span class="r-in"><span>  <span class="co">#   22.7</span></span></span>
<span class="r-in"><span>  <span class="co"># The temperature in Enschede is 22.7 Celcius degrees.</span></span></span>
<span class="r-in"><span>  <span class="co"># [1] "The temperature in Enschede is 22.7 Celcius degrees."</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2: `ellmer::tool()` -----------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alternatively, we can define the function as an 'ellmer' tool</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">temperature_in_location_ellmer</span> <span class="op">&lt;-</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">tool</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">temperature_in_location</span>,</span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="st">"get_temperature"</span>,</span></span>
<span class="r-in"><span>  description <span class="op">=</span> <span class="st">"Get the temperature in a location"</span>,</span></span>
<span class="r-in"><span>  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    location <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Location for which to return the temperature"</span>, required <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    unit <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/type_boolean.html" class="external-link">type_string</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Unit in which to return the temperature"</span>, required <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">prompt_with_weather_function_ellmer</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Utrecht? Give me Fahrenheit degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location_ellmer</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> <span style="font-weight: bold;">`answer_using_tools()`</span>:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Automatically determining type based on 'llm_provider$api_type';</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (or 'llm_provider$tool_type' if set); this does not consider model compatability</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Manually set argument 'type' if errors occur ("text-based" always works)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> * Use `options(tidyprompt.warn.auto.tools = FALSE)` to suppress this warning</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">prompt_with_weather_function_ellmer</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># ...</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Because `mcptools::mcp_tools()` returns a list of `ellmer:tool()` tools,</span></span></span>
<span class="r-in"><span><span class="co">#   you can also use Model Context Protocol (MCP) server tools with</span></span></span>
<span class="r-in"><span><span class="co">#   `answer_using_tools()`:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">prompt_using_mcp_tools</span> <span class="op">&lt;-</span> <span class="fu">mcptools</span><span class="fu">::</span><span class="fu"><a href="https://posit-dev.github.io/mcptools/reference/client.html" class="external-link">mcp_tools</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="st">"Push my latest commit to GitHub"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">mcp_tools</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">prompt_using_mcp_tools</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `answer_using_tools()` will automatically attempt to use the most appropriate</span></span></span>
<span class="r-in"><span><span class="co">#   way of sending the tool to the LLM</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you use a LLM provider of type 'ollama' or 'openai',</span></span></span>
<span class="r-in"><span><span class="co">#   it will automatically convert the tool definition to parameters</span></span></span>
<span class="r-in"><span><span class="co">#   appropriate for those APIs</span></span></span>
<span class="r-in"><span><span class="co"># If you use a LLM provider of type 'ellmer', it will call the appropriate</span></span></span>
<span class="r-in"><span><span class="co">#   ellmer function directly which will handle the tool call for various</span></span></span>
<span class="r-in"><span><span class="co">#   providers</span></span></span>
<span class="r-in"><span><span class="co"># Note that both tool definitions from `tools_add_docs()` and `ellmer::tool()`</span></span></span>
<span class="r-in"><span><span class="co">#   will work with any LLM provider; `answer_using_tools()` can convert</span></span></span>
<span class="r-in"><span><span class="co">#   the two types of tool definitions to each other when needed</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">ollama</span> <span class="op">&lt;-</span> <span class="fu"><a href="llm_provider_ollama.html">llm_provider_ollama</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Ollama LLM provider:</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Amsterdam? Give me Fahrenheit degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Ollama LLM provider also works with `ellmer::tool()` definitions:</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Amsterdam? Give me Celcius degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location_ellmer</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Similar for OpenAI API:</span></span></span>
<span class="r-in"><span>  <span class="va">openai</span> <span class="op">&lt;-</span> <span class="fu"><a href="llm_provider_openai.html">llm_provider_openai</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Amsterdam? Give me Celcius degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">openai</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># ...</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Ellmer LLM provider:</span></span></span>
<span class="r-in"><span>  <span class="va">ellmer</span> <span class="op">&lt;-</span> <span class="fu"><a href="llm_provider_ellmer.html">llm_provider_ellmer</a></span><span class="op">(</span><span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_openai.html" class="external-link">chat_openai</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Amsterdam? Give me Celcius degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location_ellmer</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ellmer</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Also works with `tools_add_docs()` definition:</span></span></span>
<span class="r-in"><span>  <span class="st">"What is the weather in Amsterdam? Give me Celcius degrees"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">answer_using_tools</span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ellmer</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe, Kennispunt Twente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

