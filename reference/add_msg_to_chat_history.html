<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add a message to a chat history — add_msg_to_chat_history • tidyprompt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add a message to a chat history — add_msg_to_chat_history"><meta name="description" content="This function appends a message to a chat_history() object.
The function can automatically determine the role of the message to be
added based on the last message in the chat history. The role can also be
manually specified."><meta property="og:description" content="This function appends a message to a chat_history() object.
The function can automatically determine the role of the message to be
added based on the last message in the chat history. The role can also be
manually specified."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_prompt_wraps.html">Creating prompt wraps</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/sentiment_analysis.html">Sentiment analysis in R with a LLM and 'tidyprompt'</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KennispuntTwente/tidyprompt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Add a message to a chat history</h1>
      <small class="dont-index">Source: <a href="https://github.com/KennispuntTwente/tidyprompt/blob/main/R/chat_history.R" class="external-link"><code>R/chat_history.R</code></a></small>
      <div class="d-none name"><code>add_msg_to_chat_history.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function appends a message to a <code><a href="chat_history.html">chat_history()</a></code> object.
The function can automatically determine the role of the message to be
added based on the last message in the chat history. The role can also be
manually specified.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_msg_to_chat_history</span><span class="op">(</span></span>
<span>  <span class="va">chat_history</span>,</span>
<span>  <span class="va">message</span>,</span>
<span>  role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"user"</span>, <span class="st">"assistant"</span>, <span class="st">"system"</span>, <span class="st">"tool"</span><span class="op">)</span>,</span>
<span>  tool_result <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-chat-history">chat_history<a class="anchor" aria-label="anchor" href="#arg-chat-history"></a></dt>
<dd><p>A single string, a data.frame which is a valid chat history
(see <code>[chat_history()]</code>), a list containing a valid chat history under key
'$chat_history', a <a href="tidyprompt-class.html">tidyprompt-class</a> object, or NULL</p>
<p>A <code><a href="chat_history.html">chat_history()</a></code> object</p></dd>


<dt id="arg-message">message<a class="anchor" aria-label="anchor" href="#arg-message"></a></dt>
<dd><p>A character string representing the message to add</p></dd>


<dt id="arg-role">role<a class="anchor" aria-label="anchor" href="#arg-role"></a></dt>
<dd><p>A character string representing the role of the message sender.
One of:</p><ul><li><p>"auto": The function automatically determines the role. If the last message
was from the user, the role will be "assistant". If the last message was from anything
else, the role will be "user"</p></li>
<li><p>"user": The message is from the user</p></li>
<li><p>"assistant": The message is from the assistant</p></li>
<li><p>"system": The message is from the system</p></li>
<li><p>"tool": The message is from a tool (e.g., indicating the result of a function call)</p></li>
</ul></dd>


<dt id="arg-tool-result">tool_result<a class="anchor" aria-label="anchor" href="#arg-tool-result"></a></dt>
<dd><p>A logical indicating whether the message is a tool result
(e.g., the result of a function call)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="chat_history.html">chat_history()</a></code> object with the message added as the last row</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The chat_history object may be of different types:</p><ul><li><p>A single string: The function will create a new chat history object
with the string as the first message; the role of that first message will be
"user"</p></li>
<li><p>A data.frame: The function will append the message to the data.frame.
The data.frame must be a valid chat history; see <code><a href="chat_history.html">chat_history()</a></code></p></li>
<li><p>A list: The function will extract the chat history from the list.
The list must contain a valid chat history under the key 'chat_history'.
This may typically be the result from <code><a href="send_prompt.html">send_prompt()</a></code> when using
'return_mode = "full"'</p></li>
<li><p>A Tidyprompt object (<a href="tidyprompt-class.html">tidyprompt</a>): The function will extract the chat history
from the object. This will be done by concatenating the 'system_prompt',
'chat_history', and 'base_prompt' into a chat history data.frame. Note
that the other properties of the <a href="tidyprompt-class.html">tidyprompt</a> object will be lost</p></li>
<li><p>NULL: The function will create a new chat history object
with no messages; the message will be the first message</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="chat_history.html">chat_history</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   role   content tool_result</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 user Hi there!       FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">chat_from_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"user"</span>, <span class="st">"assistant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hi there!"</span>, <span class="st">"Hello! How can I help you today?"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="chat_history.html">chat_history</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chat_from_df</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        role                          content tool_result</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      user                        Hi there!       FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 assistant Hello! How can I help you today?       FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `add_msg_to_chat_history()` may be used to add messages to a chat history</span></span></span>
<span class="r-in"><span><span class="va">chat_from_df</span> <span class="op">&lt;-</span> <span class="va">chat_from_df</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">add_msg_to_chat_history</span><span class="op">(</span><span class="st">"Calculate 2+2 for me, please!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chat_from_df</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        role                          content tool_result</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      user                        Hi there!       FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 assistant Hello! How can I help you today?       FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      user    Calculate 2+2 for me, please!       FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also continue conversations which originate from `send_prompt()`:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span>return_mode <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co"># Hi there!</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co"># It's nice to meet you. Is there something I can help you with, or would you</span></span></span>
<span class="r-in"><span>  <span class="co"># like to chat?</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Access the chat history from the result:</span></span></span>
<span class="r-in"><span>  <span class="va">chat_from_send_prompt</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">chat_history</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Add a message to the chat history:</span></span></span>
<span class="r-in"><span>  <span class="va">chat_history_with_new_message</span> <span class="op">&lt;-</span> <span class="va">chat_from_send_prompt</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">add_msg_to_chat_history</span><span class="op">(</span><span class="st">"Let's chat!"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The new chat history can be input for a new tidyprompt:</span></span></span>
<span class="r-in"><span>  <span class="va">prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="tidyprompt.html">tidyprompt</a></span><span class="op">(</span><span class="va">chat_history_with_new_message</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># You can also take an existing tidyprompt and add the new chat history to it;</span></span></span>
<span class="r-in"><span>  <span class="co">#   this way, you can continue a conversation using the same prompt wraps</span></span></span>
<span class="r-in"><span>  <span class="va">prompt</span><span class="op">$</span><span class="fu">set_chat_history</span><span class="op">(</span><span class="va">chat_history_with_new_message</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># send_prompt() also accepts a chat history as input:</span></span></span>
<span class="r-in"><span>  <span class="va">new_result</span> <span class="op">&lt;-</span> <span class="va">chat_history_with_new_message</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span>return_mode <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># You can also create a persistent chat history object from</span></span></span>
<span class="r-in"><span>  <span class="co">#   a chat history data frame; see ?`persistent_chat-class`</span></span></span>
<span class="r-in"><span>  <span class="va">chat</span> <span class="op">&lt;-</span> <span class="va">`persistent_chat-class`</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="llm_provider_ollama.html">llm_provider_ollama</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chat_from_send_prompt</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"Let's chat!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe, Kennispunt Twente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

