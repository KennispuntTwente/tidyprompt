<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Wrap a prompt with empowering functions — prompt_wrap • tidyprompt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wrap a prompt with empowering functions — prompt_wrap"><meta name="description" content="This function takes a single string or a tidyprompt-class object and
adds a new prompt wrap to it. A prompt wrap is a set of functions
that modify the prompt text, extract a value from the LLM response,
and validate the extracted value. The functions are used to ensure
that the prompt and LLM response is in the correct format and meets the
specified criteria; they may also be used to provide the LLM with feedback
or additional information, like the result of a tool call."><meta property="og:description" content="This function takes a single string or a tidyprompt-class object and
adds a new prompt wrap to it. A prompt wrap is a set of functions
that modify the prompt text, extract a value from the LLM response,
and validate the extracted value. The functions are used to ensure
that the prompt and LLM response is in the correct format and meets the
specified criteria; they may also be used to provide the LLM with feedback
or additional information, like the result of a tool call."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_prompt_wraps.html">Creating prompt wraps</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/sentiment_analysis.html">Sentiment analysis in R with a LLM and 'tidyprompt'</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tjarkvandemerwe/tidyprompt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Wrap a prompt with empowering functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/tjarkvandemerwe/tidyprompt/blob/main/R/prompt_wrap.R" class="external-link"><code>R/prompt_wrap.R</code></a></small>
      <div class="d-none name"><code>prompt_wrap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes a single string or a <a href="tidyprompt-class.html">tidyprompt-class</a> object and
adds a new prompt wrap to it. A prompt wrap is a set of functions
that modify the prompt text, extract a value from the LLM response,
and validate the extracted value. The functions are used to ensure
that the prompt and LLM response is in the correct format and meets the
specified criteria; they may also be used to provide the LLM with feedback
or additional information, like the result of a tool call.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prompt_wrap</span><span class="op">(</span></span>
<span>  <span class="va">prompt</span>,</span>
<span>  modify_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extraction_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  validation_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  handler_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parameter_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unspecified"</span>, <span class="st">"mode"</span>, <span class="st">"tool"</span>, <span class="st">"break"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-prompt">prompt<a class="anchor" aria-label="anchor" href="#arg-prompt"></a></dt>
<dd><p>A single string or a <a href="tidyprompt-class.html">tidyprompt-class</a> object</p></dd>


<dt id="arg-modify-fn">modify_fn<a class="anchor" aria-label="anchor" href="#arg-modify-fn"></a></dt>
<dd><p>A function that takes the previous prompt text (as
first argument) and returns the new prompt text</p></dd>


<dt id="arg-extraction-fn">extraction_fn<a class="anchor" aria-label="anchor" href="#arg-extraction-fn"></a></dt>
<dd><p>A function that takes the LLM response (as first argument)
and attempts to extract a value from it. Upon succesful extraction, the function
should return the extracted value. If the extraction fails, the function should
return a <code><a href="llm_feedback.html">llm_feedback()</a></code> message to initiate a retry. A <code><a href="llm_break.html">llm_break()</a></code> can be
returned to break the extraction and validation loop, ending <code><a href="send_prompt.html">send_prompt()</a></code></p></dd>


<dt id="arg-validation-fn">validation_fn<a class="anchor" aria-label="anchor" href="#arg-validation-fn"></a></dt>
<dd><p>A function that takes the (extracted) LLM response
(as first argument) and attempts to validate it. Upon succesful validation,
the function should return TRUE. If the validation fails, the function should
return a <code><a href="llm_feedback.html">llm_feedback()</a></code> message to initiate a retry. A <code><a href="llm_break.html">llm_break()</a></code> can be
returned to break the extraction and validation loop, ending <code><a href="send_prompt.html">send_prompt()</a></code>
object <code><a href="llm_break.html">llm_break()</a></code> can be returned to break the extraction and validation loop</p></dd>


<dt id="arg-handler-fn">handler_fn<a class="anchor" aria-label="anchor" href="#arg-handler-fn"></a></dt>
<dd><p>A function that takes a 'completion' object (as returned by
<code>llm_provider$complete_chat()</code>) and a (potentially modified) completion object.
This can be used for advanced side effects, like logging, or native tool calling,
or keeping track of token usage. See <a href="llm_provider-class.html">llm_provider-class</a> for more information;
handler_fn is attached to the <a href="llm_provider-class.html">llm_provider-class</a> object that is being used.
For example usage, see source code of <code><a href="answer_using_tools.html">answer_using_tools()</a></code></p></dd>


<dt id="arg-parameter-fn">parameter_fn<a class="anchor" aria-label="anchor" href="#arg-parameter-fn"></a></dt>
<dd><p>A function that takes the <a href="llm_provider-class.html">llm_provider-class</a> object which is being
used with <code><a href="send_prompt.html">send_prompt()</a></code> and returns a named list of parameters to be
set in the <a href="llm_provider-class.html">llm_provider-class</a> object via <code>llm_provider$set_parameters()</code>. This can be
used to configure specific parameters of the <a href="llm_provider-class.html">llm_provider-class</a> object when evaluating
the prompt. For example, <code><a href="answer_as_json.html">answer_as_json()</a></code> may set different parameters for different APIs
related to JSON output. This function is typically only used with advanced
prompt wraps that require specific settings in the <a href="llm_provider-class.html">llm_provider-class</a> object</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>The type of prompt wrap; one of 'unspecified', 'mode', 'tool', or 'break'.
Types are used to determine the order in which prompt wraps are applied.
When constructing the prompt text, prompt wraps are applied to the base prompt
in the following order: 'unspecified', 'break', 'mode', 'tool'. When evaluating
the LLM response and applying extraction and validation functions,
prompt wraps are applied in the reverse order: 'tool', 'mode', 'break', 'unspecified'.
Order among the same type is preserved in the order they were added to the prompt.
Example of a tool is <code><a href="answer_using_tools.html">answer_using_tools()</a></code>; example of a mode is <code><a href="answer_by_react.html">answer_by_react()</a></code>.
Example of a break is <code><a href="quit_if.html">quit_if()</a></code>. Most other prompt wraps will be 'unspecified',
like <code><a href="answer_as_regex.html">answer_as_regex()</a></code> or <code><a href="add_text.html">add_text()</a></code></p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>An optional name for the prompt wrap. This can be used to identify
the prompt wrap in the <a href="tidyprompt-class.html">tidyprompt-class</a> object</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="tidyprompt-class.html">tidyprompt-class</a> object with the <code>prompt_wrap()</code> appended to it</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For advanced use, modify_fn, extraction_fn, and validation_fn
may take 'llm_provider' (as used with <code><a href="send_prompt.html">send_prompt()</a></code>) as second argument, and the
http_list (a list of all HTTP requests made during send_prompt()) as third argument.
This is not required, but can be useful for more complex prompt wraps which
require additional information about the LLM provider or the HTTP requests made.</p>
<p>'modify_fn', 'extraction_fn', 'validation_fn', 'handler_fn', and 'parameter_fn'
may also access the <a href="tidyprompt-class.html">tidyprompt-class</a> object that they are a part of
through 'self$...' which is attached to their environment. For instance,
other prompt wraps can be accessed through 'self$get_prompt_wraps()'</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="tidyprompt-class.html">tidyprompt-class</a> <code><a href="send_prompt.html">send_prompt()</a></code></p>
<p>Other prompt_wrap:
<code><a href="llm_break.html">llm_break</a>()</code>,
<code><a href="llm_feedback.html">llm_feedback</a>()</code></p>
<p>Other pre_built_prompt_wraps:
<code><a href="add_text.html">add_text</a>()</code>,
<code><a href="answer_as_boolean.html">answer_as_boolean</a>()</code>,
<code><a href="answer_as_integer.html">answer_as_integer</a>()</code>,
<code><a href="answer_as_json.html">answer_as_json</a>()</code>,
<code><a href="answer_as_list.html">answer_as_list</a>()</code>,
<code><a href="answer_as_named_list.html">answer_as_named_list</a>()</code>,
<code><a href="answer_as_regex.html">answer_as_regex</a>()</code>,
<code><a href="answer_by_chain_of_thought.html">answer_by_chain_of_thought</a>()</code>,
<code><a href="answer_by_react.html">answer_by_react</a>()</code>,
<code><a href="answer_using_r.html">answer_using_r</a>()</code>,
<code><a href="answer_using_tools.html">answer_using_tools</a>()</code>,
<code><a href="quit_if.html">quit_if</a>()</code>,
<code><a href="set_system_prompt.html">set_system_prompt</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># A custom prompt_wrap may be created during piping</span></span></span>
<span class="r-in"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">prompt_wrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    modify_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_prompt</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">base_prompt</span>, <span class="st">"How are you?"</span>, sep <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prompt</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;tidyprompt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">The base prompt is modified by a prompt wrap, resulting in:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>Hi there!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>How are you? </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$base_prompt' to show the base prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$construct_prompt_text()' to get the full prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'get_prompt_wraps(x)' to show the prompt wraps.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (Shorter notation of the above:)</span></span></span>
<span class="r-in"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">prompt_wrap</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"How are you?"</span>, sep <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It may often be preferred to make a function which takes a prompt and</span></span></span>
<span class="r-in"><span><span class="co">#   returns a wrapped prompt:</span></span></span>
<span class="r-in"><span><span class="va">my_prompt_wrap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prompt</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">modify_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_prompt</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">base_prompt</span>, <span class="st">"How are you?"</span>, sep <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">prompt_wrap</span><span class="op">(</span><span class="va">prompt</span>, <span class="va">modify_fn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">my_prompt_wrap</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For more advanced examples, take a look at the source code of the</span></span></span>
<span class="r-in"><span><span class="co">#   pre-built prompt wraps in the tidyprompt package, like</span></span></span>
<span class="r-in"><span><span class="co">#   answer_as_boolean, answer_as_integer, add_tools, answer_as_code, etc.</span></span></span>
<span class="r-in"><span><span class="co"># Below is the source code for the 'answer_as_integer' prompt wrap function:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#' Make LLM answer as an integer (between min and max)</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co">#' @param prompt A single string or a [tidyprompt()] object</span></span></span>
<span class="r-in"><span><span class="co">#' @param min (optional) Minimum value for the integer</span></span></span>
<span class="r-in"><span><span class="co">#' @param max (optional) Maximum value for the integer</span></span></span>
<span class="r-in"><span><span class="co">#' @param add_instruction_to_prompt (optional) Add instruction for replying</span></span></span>
<span class="r-in"><span><span class="co">#' as an integer to the prompt text. Set to FALSE for debugging if extractions/validations</span></span></span>
<span class="r-in"><span><span class="co">#' are working as expected (without instruction the answer should fail the</span></span></span>
<span class="r-in"><span><span class="co">#' validation function, initiating a retry)</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co">#' @return A [tidyprompt()] with an added [prompt_wrap()] which</span></span></span>
<span class="r-in"><span><span class="co">#' will ensure that the LLM response is an integer.</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co">#' @export</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co">#' @example inst/examples/answer_as_integer.R</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co">#' @family pre_built_prompt_wraps</span></span></span>
<span class="r-in"><span><span class="co">#' @family answer_as_prompt_wraps</span></span></span>
<span class="r-in"><span><span class="va">answer_as_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">prompt</span>,</span></span>
<span class="r-in"><span>    <span class="va">min</span> <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    <span class="va">max</span> <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    <span class="va">add_instruction_to_prompt</span> <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="st">"You must answer with only an integer (use no other characters)."</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Enter an integer between {min} and {max}."</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Enter an integer greater than or equal to {min}."</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"Enter an integer less than or equal to {max}."</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">modify_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">original_prompt_text</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">add_instruction_to_prompt</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">original_prompt_text</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{original_prompt_text}\n\n{instruction}"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">extraction_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">extracted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="llm_feedback.html">llm_feedback</a></span><span class="op">(</span><span class="va">instruction</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">validation_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Not a whole number</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="llm_feedback.html">llm_feedback</a></span><span class="op">(</span><span class="va">instruction</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="va">min</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="llm_feedback.html">llm_feedback</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="st">"The number should be greater than or equal to {min}."</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">max</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="llm_feedback.html">llm_feedback</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="st">"The number should be less than or equal to {max}."</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">prompt_wrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">prompt</span>,</span></span>
<span class="r-in"><span>    <span class="va">modify_fn</span>, <span class="va">extraction_fn</span>, <span class="va">validation_fn</span>,</span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"answer_as_integer"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe, Kennispunt Twente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

