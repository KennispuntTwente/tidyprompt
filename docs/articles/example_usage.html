<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidyprompt">
<title>Example usage â€¢ tidyprompt</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example usage">
<meta property="og:description" content="tidyprompt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_usage.html">Example usage</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tjarkvandemerwe/tidyprompt/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tjarkvandemerwe/tidyprompt/blob/HEAD/vignettes/example_usage.Rmd" class="external-link"><code>vignettes/example_usage.Rmd</code></a></small>
      <div class="d-none name"><code>example_usage.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tjarkvandemerwe/tidyprompt" class="external-link">tidyprompt</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyprompt'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     prompt</span></span></code></pre></div>
<div class="section level3">
<h3 id="setup-an-llm-provider">Setup an LLM provider<a class="anchor" aria-label="anchor" href="#setup-an-llm-provider"></a>
</h3>
<p><code>tidyprompt</code> can be used with any LLM provider capable of
completing a chat.</p>
<p>At the moment, <code>tidyprompt</code> includes pre-built functions
to connect with Ollama and the OpenAI API.</p>
<p>With the <code>create_llm_provider</code> function, you can easily
write a hook for any other LLM provider. You could make API calls using
the <code>httr</code> package or use another R package that already has
a hook for the LLM provider you want to use.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ollama running on local PC</span></span>
<span><span class="va">ollama</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_ollama_llm_provider.html">create_ollama_llm_provider</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"llama3.1:8b"</span>, url <span class="op">=</span> <span class="st">"http://localhost:11434/api/chat"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># OpenAI API</span></span>
<span><span class="va">openai</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_openai_llm_provider.html">create_openai_llm_provider</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4o-mini"</span>, api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create your own LLM provider hook using create_llm_provider(); </span></span>
<span><span class="co">#   see ?create_llm_provider for more information, and take a look at</span></span>
<span><span class="co">#   the source code of create_ollama_llm_provider() and create_openai_llm_provider()</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basic-prompting">Basic prompting<a class="anchor" aria-label="anchor" href="#basic-prompting"></a>
</h3>
<p>A simple string serves as the base for a prompt.</p>
<p>By adding prompt wrappers, you can influence various aspects of how
the LLM handles the prompt, while verifying that the output is
structured and valid (including retries with feedback to the LLM if it
is not).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "It's nice to meet you. Is there something I can help you with, or would you like to chat?"</span></span></code></pre></div>
<p><code>add_text</code> is a simple example of a prompt wrapper. It
simply adds some text at the end of the base prompt.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/add_text.html">add_text</a></span><span class="op">(</span><span class="st">"What is a large language model? Explain in 10 words."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sophisticated computer program that processes and generates human-like written language rapidly."</span></span></code></pre></div>
<p>You can also construct the final prompt text, without sending it to
an LLM provider.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"Hi there!"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/add_text.html">add_text</a></span><span class="op">(</span><span class="st">"What is a large language model? Explain in 10 words."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/construct_prompt_text.html">construct_prompt_text</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hi there!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; What is a large language model? Explain in 10 words.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-output-in-a-specific-format">Retrieving output in a specific format<a class="anchor" aria-label="anchor" href="#retrieving-output-in-a-specific-format"></a>
</h3>
<p>Using prompt wrappers, you can force the LLM to return the output in
a specific format. You can also extract the output to turn it from a
character into another data type.</p>
<p>For instance, the <code>answer_as_integer</code> prompt wrapper will
force the LLM to return an integer.</p>
<p>To achieve this, the prompt wrapper will add some text to the base
prompt, asking the LLM to reply with an integer. However, the prompt
wrapper does more: it also will attempt to extract and validate the
integer from the LLMâ€™s response. If extraction or validation fails,
feedback is sent back to the LLM, after which the LLM can retry
answering the prompt.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"What is 2 + 2?"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/answer_as_integer.html">answer_as_integer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; What is 2 + 2?</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You must answer with only an integer (use no other characters).</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; 4</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>Below is an example of a prompt which will initially fail, but will
succeed after a retry.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"What is 2 + 2?"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/add_text.html">add_text</a></span><span class="op">(</span><span class="st">"Please write out your reply in words, use no numbers."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/answer_as_integer.html">answer_as_integer</a></span><span class="op">(</span>add_instruction_to_prompt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; What is 2 + 2?</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Please write out your reply in words, use no numbers.</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; Four.</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; You must answer with only an integer (use no other characters).</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; 4</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-a-reasoning-mode-to-the-llm">Adding a reasoning mode to the LLM<a class="anchor" aria-label="anchor" href="#adding-a-reasoning-mode-to-the-llm"></a>
</h3>
<p>Prompt wrappers may also be used to add a reasoning mode to the LLM.
It is hypothesized that this could improve the LLMâ€™s performance on more
complex tasks.</p>
<p>For instance, function <code>answer_by_chain_of_thought</code> will
add chain of thought reasoning mode to the LLM. This wraps the base
prompt within a request for the LLM to reason step by step, asking it to
provide the final answer within â€˜FINISH[<final answer here>]â€™. An
extraction function then ensures only the final answer is returned.</final></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="st">"What is 2 + 2?"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/answer_by_chain_of_thought.html">answer_by_chain_of_thought</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/answer_as_integer.html">answer_as_integer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; You are given a user's prompt.</span></span>
<span><span class="co">#&gt; To answer the user's prompt, you need to think step by step to arrive at a final answer.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ----- START OF USER'S PROMPT -----</span></span>
<span><span class="co">#&gt; What is 2 + 2?</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You must answer with only an integer (use no other characters).</span></span>
<span><span class="co">#&gt; ----- END OF USER'S PROMPT -----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; What are the steps you would take to answer the user's prompt?</span></span>
<span><span class="co">#&gt; Describe your thought process in the following format:</span></span>
<span><span class="co">#&gt;   &gt;&gt; step 1: &lt;step 1 description&gt;</span></span>
<span><span class="co">#&gt;   &gt;&gt; step 2: &lt;step 2 description&gt;</span></span>
<span><span class="co">#&gt;   (etc.)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; When you are done, you must type:</span></span>
<span><span class="co">#&gt; FINISH[&lt;put here your final answer to the user's prompt&gt;]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Make sure your final answer follows the logical conclusion of your thought process.</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; &gt;&gt; step 1: The user is asking for the sum of two numbers, specifically 2 and 2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 2: To find this sum, I need to recall basic arithmetic operations, specifically addition.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 3: In mathematics, when adding two numbers together, you combine their values by counting up from one number to the other. For example, if we are adding 1 + 1, you count up from 1: 1, 2 (which is the sum of 1 and 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 4: Applying this concept to the user's prompt, I will add 2 to itself by counting up from 2. Starting with 2, we count up by 1s until we reach the second 2: 2, 3 (which is the sum of 2 and 1), but since we're counting up by twos, we only need to count up once more: 4.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 5: Therefore, the sum of 2 and 2 is 4.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FINISH 4</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; Error, could not parse your final answer.</span></span>
<span><span class="co">#&gt; Please type: 'FINISH[&lt;put here your final answer to the original prompt&gt;]'</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; Here is the corrected response:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 1: The user is asking for the sum of two numbers, specifically 2 and 2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 2: To find this sum, I need to recall basic arithmetic operations, specifically addition.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 3: In mathematics, when adding two numbers together, you combine their values by counting up from one number to the other. For example, if we are adding 1 + 1, you count up from 1: 1, 2 (which is the sum of 1 and 1).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 4: Applying this concept to the user's prompt, I will add 2 to itself by counting up from 2. Starting with 2, we count up by 1s until we reach the second 2: 2, 3 (which is the sum of 2 and 1), but since we're counting up by twos, we only need to count up once more: 4.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt;&gt; step 5: Therefore, the sum of 2 and 2 is 4.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FINISH[4]</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="giving-tools-to-the-llm-autonomous-function-calling">Giving tools to the LLM (autonomous function-calling)<a class="anchor" aria-label="anchor" href="#giving-tools-to-the-llm-autonomous-function-calling"></a>
</h3>
<p>With <code>tidyprompt</code>, you can define R functions and give the
LLM the ability to call them. This enables the LLM to retrieve
additional information or take other actions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Define a function that returns fake data about the temperature in a location</span></span>
<span>  <span class="va">temperature_in_location</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">location</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amsterdam"</span>, <span class="st">"Utrecht"</span>, <span class="st">"Enschede"</span><span class="op">)</span>,</span>
<span>    <span class="va">unit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Celcius"</span>, <span class="st">"Fahrenheit"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#' llm_tool::name temperature_in_location</span></span>
<span>    <span class="co">#'</span></span>
<span>    <span class="co">#' llm_tool::description Get the temperature in a location</span></span>
<span>    <span class="co">#'</span></span>
<span>    <span class="co">#' llm_tool::param location Location, must be one of: "Amsterdam", "Utrecht", "Enschede"</span></span>
<span>    <span class="co">#' llm_tool::param unit Unit, must be one of: "Celcius", "Fahrenheit"</span></span>
<span>    <span class="co">#'</span></span>
<span>    <span class="co">#' llm_tool::return The temperature in the specified location and unit</span></span>
<span>    <span class="co">#'</span></span>
<span>    <span class="co">#' llm_tool::example</span></span>
<span>    <span class="co">#' temperature_in_location("Amsterdam", "Fahrenheit")</span></span>
<span>    </span>
<span>    <span class="co"># As shown above, one can use docstring-like text to document the function.</span></span>
<span>    <span class="co">#   This will provide the LLM information on what the function does,</span></span>
<span>    <span class="co">#   and how it should be used.</span></span>
<span>    </span>
<span>    <span class="va">location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span></span>
<span>    <span class="va">unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">unit</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">temperature_celcius</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span></span>
<span>      <span class="va">location</span>,</span>
<span>      <span class="st">"Amsterdam"</span> <span class="op">=</span> <span class="fl">32.5</span>,</span>
<span>      <span class="st">"Utrecht"</span> <span class="op">=</span> <span class="fl">19.8</span>,</span>
<span>      <span class="st">"Enschede"</span> <span class="op">=</span> <span class="fl">22.7</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">unit</span> <span class="op">==</span> <span class="st">"Celcius"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">temperature_celcius</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">temperature_celcius</span> <span class="op">*</span> <span class="fl">9</span><span class="op">/</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">32</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Ask the LLM a question which can be answered with the function</span></span>
<span>  <span class="st">"Hi, what is the weather temperature in Enschede?"</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/add_text.html">add_text</a></span><span class="op">(</span><span class="st">"I want to know the Celcius degrees."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/answer_as_integer.html">answer_as_integer</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/add_tools.html">add_tools</a></span><span class="op">(</span><span class="va">temperature_in_location</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="va">ollama</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; Hi, what is the weather temperature in Enschede?</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I want to know the Celcius degrees.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You must answer with only an integer (use no other characters).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; If you need more information, you can call functions to help you.</span></span>
<span><span class="co">#&gt; To call a function, type:</span></span>
<span><span class="co">#&gt;   FUNCTION[&lt;function name here&gt;](&lt;argument 1&gt;, &lt;argument 2&gt;, etc...)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following functions are available:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; function name: temperature_in_location</span></span>
<span><span class="co">#&gt; description: Get the temperature in a location</span></span>
<span><span class="co">#&gt; arguments:</span></span>
<span><span class="co">#&gt;     - location: Location, must be one of: "Amsterdam", "Utrecht", "Enschede"</span></span>
<span><span class="co">#&gt;     - unit: Unit, must be one of: "Celcius", "Fahrenheit"</span></span>
<span><span class="co">#&gt; return value: The temperature in the specified location and unit</span></span>
<span><span class="co">#&gt; example usage: FUNCTION[temperature_in_location]("Amsterdam", "Fahrenheit")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; After you call a function, wait until you receive more information.</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; FUNCTION[temperature_in_location]("Enschede", "Celcius")</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; function called: temperature_in_location</span></span>
<span><span class="co">#&gt; arguments used: Enschede, Celcius</span></span>
<span><span class="co">#&gt; result: 22.7</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; The weather temperature in Enschede is 22 degrees Celsius.</span></span>
<span><span class="co">#&gt; --- Sending message to LLM-provider: ---</span></span>
<span><span class="co">#&gt; You must answer with only an integer (use no other characters).</span></span>
<span><span class="co">#&gt; --- Received response from LLM-provider: ---</span></span>
<span><span class="co">#&gt; 22</span></span>
<span><span class="co">#&gt; [1] 22</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-your-own-prompt-wrappers">Creating your own prompt wrappers<a class="anchor" aria-label="anchor" href="#creating-your-own-prompt-wrappers"></a>
</h3>
<p>Under the hood, prompts are just lists of a base prompt (a string)
and a series of prompt wrappers.</p>
<p>You can thus create a function which takes a prompt and appends a new
prompt wrapper to it.</p>
<p>Take a look at the source code for function
<code>add_text</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add_text</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">prompt</span>,</span>
<span>    <span class="va">text</span>, <span class="va">position</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"after"</span>, <span class="st">"before"</span><span class="op">)</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">"\n\n"</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">position</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">modify_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">original_prompt_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">position</span> <span class="op">==</span> <span class="st">"after"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">original_prompt_text</span>, <span class="va">text</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">original_prompt_text</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">new_wrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prompt_wrap.html">prompt_wrap</a></span><span class="op">(</span></span>
<span>    modify_fn <span class="op">=</span> <span class="va">modify_fn</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">append_prompt_wrap</span><span class="op">(</span><span class="va">prompt</span>, <span class="va">new_wrap</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>More complex prompt wrappers may also add extraction and validation
functions. Take a look at the source code for function
<code>answer_as_integer</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">answer_as_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">prompt</span>,</span>
<span>    <span class="va">min</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">max</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">add_instruction_to_prompt</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="st">"You must answer with only an integer (use no other characters)."</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Enter an integer between {min} and {max}."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Enter an integer greater than or equal to {min}."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">instruction</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Enter an integer less than or equal to {max}."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Define modification/extraction/validation functions:</span></span>
<span>  <span class="va">modify_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">original_prompt_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">add_instruction_to_prompt</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">original_prompt_text</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{original_prompt_text}\n\n{instruction}"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">extraction_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">extracted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/create_llm_feedback.html">create_llm_feedback</a></span><span class="op">(</span><span class="va">instruction</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">validation_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="va">min</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/create_llm_feedback.html">create_llm_feedback</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"The number should be greater than or equal to {min}."</span></span>
<span>      <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">max</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">max</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/create_llm_feedback.html">create_llm_feedback</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"The number should be less than or equal to {max}."</span></span>
<span>      <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">new_wrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prompt_wrap.html">prompt_wrap</a></span><span class="op">(</span></span>
<span>    modify_fn <span class="op">=</span> <span class="va">modify_fn</span>,</span>
<span>    extraction_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">extraction_fn</span><span class="op">)</span>,</span>
<span>    validation_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">validation_fn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">append_prompt_wrap</span><span class="op">(</span><span class="va">prompt</span>, <span class="va">new_wrap</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>They key difference between an extraction and validation function is
that an extraction function alters the LLMâ€™s response and passes on the
altered response to next extraction and/or validation functions, and
eventually to the return statement of send_prompt (if extractions and
validations are succesful). A validation function, on the other hand,
only checks if the LLMâ€™s response passes a logical test. Both extraction
and validation functions can return feedback to the LLM.</p>
<p>For more information, on what you can do with prompt wrappers, see
the documentation of the <code>prompt_wrap</code> class creator
function: <code>create_prompt_wrap</code>. For examples of prompt
wrapper functions, see, for instance the documentation and source code
of <code>add_text</code>, <code>answer_as_integer</code>,
<code>answer_by_chain_of_thought</code>, and <code>add_tools</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
