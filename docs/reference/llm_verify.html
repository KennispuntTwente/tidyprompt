<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Have a LLM check the result of a prompt (LLM-in-the-loop) — llm_verify • tidyprompt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Have a LLM check the result of a prompt (LLM-in-the-loop) — llm_verify"><meta name="description" content="This function will wrap a prompt with a check for a LLM to accept or decline
the result of the prompt, providing feedback if the result is declined.
The evaluating LLM will be presented with the original prompt and the result
of the prompt, and will be asked to verify if the answer is satisfactory
(using chain of thought reasoning to arrive at a boolean decision). If
the result is declined, the chain of thought responsible for the decision
will be summarized and sent back to the original LLM that was asked to
evaluate the prompt, so that it may retry the prompt.
Note that this function is experimental and, because it relies on chain of
thought reasoning by a LLM about the answer of another LLM, it may not
always provide accurate results and can dramatically increase the token cost of
evaluating a prompt."><meta property="og:description" content="This function will wrap a prompt with a check for a LLM to accept or decline
the result of the prompt, providing feedback if the result is declined.
The evaluating LLM will be presented with the original prompt and the result
of the prompt, and will be asked to verify if the answer is satisfactory
(using chain of thought reasoning to arrive at a boolean decision). If
the result is declined, the chain of thought responsible for the decision
will be summarized and sent back to the original LLM that was asked to
evaluate the prompt, so that it may retry the prompt.
Note that this function is experimental and, because it relies on chain of
thought reasoning by a LLM about the answer of another LLM, it may not
always provide accurate results and can dramatically increase the token cost of
evaluating a prompt."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_prompt_wraps.html">Creating prompt wraps</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/sentiment_analysis.html">Sentiment analysis in R with a LLM and 'tidyprompt'</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tjarkvandemerwe/tidyprompt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Have a LLM check the result of a prompt (LLM-in-the-loop)</h1>
      <small class="dont-index">Source: <a href="https://github.com/tjarkvandemerwe/tidyprompt/blob/HEAD/R/misc_llm_verify.R" class="external-link"><code>R/misc_llm_verify.R</code></a></small>
      <div class="d-none name"><code>llm_verify.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function will wrap a prompt with a check for a LLM to accept or decline
the result of the prompt, providing feedback if the result is declined.
The evaluating LLM will be presented with the original prompt and the result
of the prompt, and will be asked to verify if the answer is satisfactory
(using chain of thought reasoning to arrive at a boolean decision). If
the result is declined, the chain of thought responsible for the decision
will be summarized and sent back to the original LLM that was asked to
evaluate the prompt, so that it may retry the prompt.</p>
<p>Note that this function is experimental and, because it relies on chain of
thought reasoning by a LLM about the answer of another LLM, it may not
always provide accurate results and can dramatically increase the token cost of
evaluating a prompt.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">llm_verify</span><span class="op">(</span><span class="va">prompt</span>, llm_provider <span class="op">=</span> <span class="cn">NULL</span>, max_words_feedback <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-prompt">prompt<a class="anchor" aria-label="anchor" href="#arg-prompt"></a></dt>
<dd><p>A single string or a <a href="tidyprompt-class.html">tidyprompt</a> object</p></dd>


<dt id="arg-llm-provider">llm_provider<a class="anchor" aria-label="anchor" href="#arg-llm-provider"></a></dt>
<dd><p>A <a href="llm_provider-class.html">llm_provider</a> object
which will be used to verify the evaluation led to a satisfactory result.
If not provided, the same LLM provider as the prompt was originally
evaluated with will be used</p></dd>


<dt id="arg-max-words-feedback">max_words_feedback<a class="anchor" aria-label="anchor" href="#arg-max-words-feedback"></a></dt>
<dd><p>The maximum number of words allowed in the summary of
why the result was declined.
This summary is sent back to the LLM originally asked to evaluate the prompt</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="tidyprompt-class.html">tidyprompt</a> with an added <code><a href="prompt_wrap.html">prompt_wrap()</a></code> which
will add a check for a LLM to accept or decline the result of the prompt,
providing feedback if the result is declined</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="st">"What is 'Enschede'?!"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="answer_as_text.html">answer_as_text</a></span><span class="op">(</span>max_words <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">llm_verify</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co"># What is 'Enschede'?!</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># You must provide a text response. The response must be at most 50 words.</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co"># Enschede is a city in the eastern Netherlands, located in the province of Overijssel.</span></span></span>
<span class="r-in"><span>  <span class="co"># It has a population of around 160,000 people and is known for its textile industry heritage,</span></span></span>
<span class="r-in"><span>  <span class="co"># universities (including the University of Twente), and cultural attractions like</span></span></span>
<span class="r-in"><span>  <span class="co"># the Rietveld Schröder House, a UNESCO World Heritage Site.</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co"># You are given a user's prompt.</span></span></span>
<span class="r-in"><span>  <span class="co"># To answer the user's prompt, you need to think step by step to arrive at a final answer.</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># ----- START OF USER'S PROMPT -----</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt;&gt; An assistant was asked:</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># What is 'Enschede'?!</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># You must provide a text response. The response must be at most 50 words.</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt;&gt; The assistant answered:</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co">#   [1] "Enschede is a city in the eastern Netherlands, located in the province of Overijssel.</span></span></span>
<span class="r-in"><span>  <span class="co">#   It has a population of around 160,000 people and is known for its textile industry heritage,</span></span></span>
<span class="r-in"><span>  <span class="co">#   universities (including the University of Twente), and cultural attractions like</span></span></span>
<span class="r-in"><span>  <span class="co">#   the Rietveld Schröder House, a UNESCO World Heritage Site."</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt;&gt; Please verify if the answer is satisfactory.</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># You must answer with only TRUE or FALSE (use no other characters).</span></span></span>
<span class="r-in"><span>  <span class="co"># ----- END OF USER'S PROMPT -----</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># What are the steps you would take to answer the user's prompt?</span></span></span>
<span class="r-in"><span>  <span class="co"># Describe your thought process in the following format:</span></span></span>
<span class="r-in"><span>  <span class="co">#   &gt;&gt; step 1: &lt;step 1 description&gt;</span></span></span>
<span class="r-in"><span>  <span class="co">#   &gt;&gt; step 2: &lt;step 2 description&gt;</span></span></span>
<span class="r-in"><span>  <span class="co">#   (etc.)</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># When you are done, you must type:</span></span></span>
<span class="r-in"><span>  <span class="co">#   FINISH[&lt;put here your final answer to the user's prompt&gt;]</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># Make sure your final answer follows the logical conclusion of your thought process.</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt; step 1: Read and understand the original user's prompt, which asks for a text</span></span></span>
<span class="r-in"><span>  <span class="co"># response with at most 50 words.</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt; step 2: Read and compare the assistant's initial answer to the original user's</span></span></span>
<span class="r-in"><span>  <span class="co"># prompt to see if it meets the specified requirements.</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt; step 3: Determine if the assistant's answer is within the 50-word limit by counting</span></span></span>
<span class="r-in"><span>  <span class="co"># the number of words in the response.</span></span></span>
<span class="r-in"><span>  <span class="co"># &gt;&gt; step 4: Verify that the content of the assistant's answer provides a concise</span></span></span>
<span class="r-in"><span>  <span class="co"># and relevant description of what "Enschede" is, considering its context and purpose.</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># Based on these steps, I conclude:</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co"># FINISH[TRUE]</span></span></span>
<span class="r-in"><span>  <span class="co"># [1] "Enschede is a city in the eastern Netherlands, located in the province of Overijssel.</span></span></span>
<span class="r-in"><span>  <span class="co"># It has a population of around 160,000 people and is known for its textile industry heritage,</span></span></span>
<span class="r-in"><span>  <span class="co"># universities (including the University of Twente), and cultural attractions like the</span></span></span>
<span class="r-in"><span>  <span class="co"># Rietveld Schröder House, a UNESCO World Heritage Site."</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe, Kennispunt Twente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

