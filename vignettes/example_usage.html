<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Example usage</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Example usage</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyprompt)</span></code></pre></div>
<div id="setup-an-llm-provider" class="section level3">
<h3>Setup an LLM provider</h3>
<p><code>tidyprompt</code> can be used with any LLM provider capable of
completing a chat.</p>
<p>At the moment, <code>tidyprompt</code> includes pre-built functions
to connect with Ollama and the OpenAI API.</p>
<p>With the <code>create_llm_provider</code> function, you can easily
write a hook for any other LLM provider. You could make API calls using
the <code>httr</code> package or use another R package that already has
a hook for the LLM provider you want to use.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Ollama running on local PC</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ollama <span class="ot">&lt;-</span> <span class="fu">create_ollama_llm_provider</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(<span class="at">model =</span> <span class="st">&quot;llama3.1:8b&quot;</span>, <span class="at">url =</span> <span class="st">&quot;http://localhost:11434/api/chat&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># OpenAI API</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>openai <span class="ot">&lt;-</span> <span class="fu">create_openai_llm_provider</span>(</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">list</span>(<span class="at">model =</span> <span class="st">&quot;gpt-4o-mini&quot;</span>, <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;OPENAI_API_KEY&quot;</span>))</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># Create your own LLM provider hook using create_llm_provider(); </span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#   see ?create_llm_provider for more information, and take a look at</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#   the source code of create_ollama_llm_provider() and create_openai_llm_provider()</span></span></code></pre></div>
</div>
<div id="basic-prompting" class="section level3">
<h3>Basic prompting</h3>
<p>A simple string serves as the base for a prompt.</p>
<p>By adding prompt wrappers, you can influence various aspects of how
the LLM handles the prompt, while verifying that the output is
structured and valid (including retries with feedback to the LLM if it
is not).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>  <span class="st">&quot;Hi there!&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama)</span></code></pre></div>
<pre><code>## [1] &quot;How&#39;s your day going so far? Is there something I can help you with or would you like to chat?&quot;</code></pre>
<p><code>add_text</code> is a simple example of a prompt wrapper. It
simply adds some text at the end of the base prompt.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>  <span class="st">&quot;Hi there!&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="fu">add_text</span>(<span class="st">&quot;What is a large language model? Explain in 10 words.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama)</span></code></pre></div>
<pre><code>## [1] &quot;Advanced artificial intelligence system that processes and generates human-like written content.&quot;</code></pre>
<p>You can also construct the final prompt text, without sending it to
an LLM provider.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>  <span class="st">&quot;Hi there!&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="fu">add_text</span>(<span class="st">&quot;What is a large language model? Explain in 10 words.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="fu">construct_prompt_text</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="fu">cat</span>()</span></code></pre></div>
<pre><code>## Hi there!
## 
## What is a large language model? Explain in 10 words.</code></pre>
</div>
<div id="retrieving-output-in-a-specific-format" class="section level3">
<h3>Retrieving output in a specific format</h3>
<p>Using prompt wrappers, you can force the LLM to return the output in
a specific format. You can also extract the output to turn it from a
character into another data type.</p>
<p>For instance, the <code>answer_as_integer</code> prompt wrapper will
force the LLM to return an integer.</p>
<p>To achieve this, the prompt wrapper will add some text to the base
prompt, asking the LLM to reply with an integer. However, the prompt
wrapper does more: it also will attempt to extract and validate the
integer from the LLM’s response. If extraction or validation fails,
feedback is sent back to the LLM, after which the LLM can retry
answering the prompt.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>  <span class="st">&quot;What is 2 + 2?&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="fu">answer_as_integer</span>(<span class="at">add_instruction_to_prompt =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## What is 2 + 2?
## 
## You must answer with only an integer (use no other characters).</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## 4</code></pre>
<pre><code>## [1] 4</code></pre>
<p>Below is an example of a prompt which will initially fail, but will
succeed after a retry.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>  <span class="st">&quot;What is 2 + 2?&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    <span class="fu">add_text</span>(<span class="st">&quot;Please write out your reply in words, use no numbers.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="fu">answer_as_integer</span>(<span class="at">add_instruction_to_prompt =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## What is 2 + 2?
## 
## Please write out your reply in words, use no numbers.</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## Two plus two equals four.</code></pre>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## You must answer with only an integer (use no other characters).</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## 4</code></pre>
<pre><code>## [1] 4</code></pre>
</div>
<div id="adding-a-reasoning-mode-to-the-llm" class="section level3">
<h3>Adding a reasoning mode to the LLM</h3>
<p>Prompt wrappers may also be used to add a reasoning mode to the LLM.
It is hypothesized that this could improve the LLM’s performance on more
complex tasks.</p>
<p>For instance, function <code>set_mode_chainofthought</code> will add
chain of thought reasoning mode to the LLM. This wraps the base prompt
within a request for the LLM to reason step by step, asking it to
provide the final answer within ‘FINISH[<final answer here>]’. An
extraction function then ensures only the final answer is returned.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>  <span class="st">&quot;What is 2 + 2?&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>    <span class="fu">set_mode_chainofthought</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    <span class="fu">answer_as_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## You are given a user&#39;s prompt.
## To answer the user&#39;s prompt, you need to think step by step to arrive at a final answer.
## 
## ----- START OF USER&#39;S PROMPT -----
## What is 2 + 2?
## ----- END OF USER&#39;S PROMPT -----
## 
## What are the steps you would take to answer the user&#39;s prompt?
## Describe your thought process in the following format:
##   &gt;&gt; step 1: &lt;step 1 description&gt;
##   &gt;&gt; step 2: &lt;step 2 description&gt;
##   (etc.)
## 
## When you are done, you must type:
## FINISH[&lt;put here your final answer to the user&#39;s prompt&gt;]
## 
## Make sure your final answer follows the logical conclusion of your thought process.</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## &gt;&gt; step 1: Identify the mathematical operation required by the user&#39;s prompt.
## The prompt is asking for a simple arithmetic calculation, so I need to determine what type of math operation is being performed.
## 
## &gt;&gt; step 2: Determine the specific math operation.
## In this case, the prompt specifies &quot;addition&quot; using the plus sign (+) between two numbers (2 and 2).
## 
## &gt;&gt; step 3: Recall basic arithmetic facts for addition.
## I know that adding two identical numbers together results in a product of 4.
## 
## &gt;&gt; step 4: Apply the basic arithmetic fact to the user&#39;s prompt.
## Since I&#39;m adding 2 + 2, my thought process tells me to recall that 2 + 2 = 4.
## 
## FINISH[4]</code></pre>
<pre><code>## [1] 4</code></pre>
</div>
<div id="giving-tools-to-the-llm-autonomous-function-calling" class="section level3">
<h3>Giving tools to the LLM (autonomous function-calling)</h3>
<p>With <code>tidyprompt</code>, you can define R functions and give the
LLM the ability to call them. This enables the LLM to retrieve
additional information or take other actions.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>  <span class="co"># Define a function that returns fake data about the temperature in a location</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  temperature_in_location <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    <span class="at">location =</span> <span class="fu">c</span>(<span class="st">&quot;Amsterdam&quot;</span>, <span class="st">&quot;Utrecht&quot;</span>, <span class="st">&quot;Enschede&quot;</span>),</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="at">unit =</span> <span class="fu">c</span>(<span class="st">&quot;Celcius&quot;</span>, <span class="st">&quot;Fahrenheit&quot;</span>)</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  ) {</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::name temperature_in_location</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>    <span class="co">#&#39;</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::description Get the temperature in a location</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>    <span class="co">#&#39;</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::param location Location, must be one of: &quot;Amsterdam&quot;, &quot;Utrecht&quot;, &quot;Enschede&quot;</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::param unit Unit, must be one of: &quot;Celcius&quot;, &quot;Fahrenheit&quot;</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    <span class="co">#&#39;</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::return The temperature in the specified location and unit</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    <span class="co">#&#39;</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    <span class="co">#&#39; llm_tool::example</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    <span class="co">#&#39; temperature_in_location(&quot;Amsterdam&quot;, &quot;Fahrenheit&quot;)</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>    </span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>    <span class="co"># As shown above, one can use docstring-like text to document the function.</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>    <span class="co">#   This will provide the LLM information on what the function does,</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>    <span class="co">#   and how it should be used.</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>    </span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>    location <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(location)</span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>    unit <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(unit)</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>    temperature_celcius <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a>      location,</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>      <span class="st">&quot;Amsterdam&quot;</span> <span class="ot">=</span> <span class="fl">32.5</span>,</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>      <span class="st">&quot;Utrecht&quot;</span> <span class="ot">=</span> <span class="fl">19.8</span>,</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>      <span class="st">&quot;Enschede&quot;</span> <span class="ot">=</span> <span class="fl">22.7</span></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>    )</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a>    <span class="cf">if</span> (unit <span class="sc">==</span> <span class="st">&quot;Celcius&quot;</span>) {</span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>      <span class="fu">return</span>(temperature_celcius)</span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a>      <span class="fu">return</span>(temperature_celcius <span class="sc">*</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">5</span> <span class="sc">+</span> <span class="dv">32</span>)</span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a>    }</span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a>  }</span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a>  <span class="co"># Ask the LLM a question which can be answered with the function</span></span>
<span id="cb31-40"><a href="#cb31-40" tabindex="-1"></a>  <span class="st">&quot;Hi, what is the weather temperature in Enschede?&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb31-41"><a href="#cb31-41" tabindex="-1"></a>    <span class="fu">add_text</span>(<span class="st">&quot;I want to know the Celcius degrees.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-42"><a href="#cb31-42" tabindex="-1"></a>    <span class="fu">answer_as_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-43"><a href="#cb31-43" tabindex="-1"></a>    <span class="fu">add_tools</span>(temperature_in_location) <span class="sc">|&gt;</span></span>
<span id="cb31-44"><a href="#cb31-44" tabindex="-1"></a>    <span class="fu">send_prompt</span>(ollama, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## Hi, what is the weather temperature in Enschede?
## 
## I want to know the Celcius degrees.
## 
## If you need more information, you can call functions to help you.
## To call a function, type:
##   FUNCTION[&lt;function name here&gt;](&lt;argument 1&gt;, &lt;argument 2&gt;, etc...)
## 
## The following functions are available:
## 
## function name: temperature_in_location
## description: Get the temperature in a location
## arguments:
##     - location: Location, must be one of: &quot;Amsterdam&quot;, &quot;Utrecht&quot;, &quot;Enschede&quot;
##     - unit: Unit, must be one of: &quot;Celcius&quot;, &quot;Fahrenheit&quot;
## return value: The temperature in the specified location and unit
## example usage: FUNCTION[temperature_in_location](&quot;Amsterdam&quot;, &quot;Fahrenheit&quot;)
## 
## After you call a function, wait until you receive more information.</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## To get the weather temperature in Enschede, I&#39;ll use the `temperature_in_location` function.
## 
## FUNCTION[temperature_in_location](&quot;Enschede&quot;, &quot;Celcius&quot;)</code></pre>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## function called: temperature_in_location
## arguments used: Enschede, Celcius
## result: 22.7</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## The current temperature in Enschede is 22.7°C! That&#39;s a nice warm day. I&#39;m glad we could use the `temperature_in_location` function to get that information. If you want to know the temperature somewhere else or in a different unit, just let me know!</code></pre>
<pre><code>## --- Sending message to LLM-provider: ---</code></pre>
<pre><code>## You must answer with only an integer (use no other characters).</code></pre>
<pre><code>## --- Received response from LLM-provider: ---</code></pre>
<pre><code>## 22</code></pre>
<pre><code>## [1] 22</code></pre>
</div>
<div id="creating-your-own-prompt-wrappers" class="section level3">
<h3>Creating your own prompt wrappers</h3>
<p>Under the hood, prompts are just lists of a base prompt (a string)
and a series of prompt wrappers.</p>
<p>You can thus create a function which takes a prompt and appends a new
prompt wrapper to it.</p>
<p>Take a look at the source code for function
<code>add_text</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>add_text <span class="ot">&lt;-</span> <span class="cf">function</span>(prompt_wrap_or_list, text, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>) {</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  prompt_list <span class="ot">&lt;-</span> <span class="fu">validate_prompt_list</span>(prompt_wrap_or_list)</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  new_wrap <span class="ot">&lt;-</span> <span class="fu">create_prompt_wrap</span>(</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>    <span class="at">modify_fn =</span> <span class="cf">function</span>(original_prompt_text, modify_fn_args) {</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>      text <span class="ot">&lt;-</span> modify_fn_args<span class="sc">$</span>text</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>      sep <span class="ot">&lt;-</span> modify_fn_args<span class="sc">$</span>sep</span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">paste</span>(original_prompt_text, text, <span class="at">sep =</span> sep))</span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>    },</span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>    <span class="at">modify_fn_args =</span> <span class="fu">list</span>(<span class="at">text =</span> text, <span class="at">sep =</span> sep)</span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>  )</span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(prompt_list, <span class="fu">list</span>(new_wrap)))</span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a>}</span></code></pre></div>
<p>More complex prompt wrappers may also add extraction and validation
functions. Take a look at the source code for function
<code>answer_as_integer</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>answer_as_integer <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>    prompt_wrap_or_list, <span class="at">min =</span> <span class="cn">NULL</span>, <span class="at">max =</span> <span class="cn">NULL</span>, <span class="at">add_instruction_to_prompt =</span> <span class="cn">FALSE</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>) {</span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>  prompt_list <span class="ot">&lt;-</span> <span class="fu">validate_prompt_list</span>(prompt_wrap_or_list)</span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>  new_wrap <span class="ot">&lt;-</span> <span class="fu">create_prompt_wrap</span>(</span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>    <span class="at">modify_fn =</span> <span class="cf">function</span>(original_prompt_text, modify_fn_args) {</span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>      min <span class="ot">&lt;-</span> modify_fn_args<span class="sc">$</span>min</span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a>      max <span class="ot">&lt;-</span> modify_fn_args<span class="sc">$</span>max</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a>      new_prompt_text <span class="ot">&lt;-</span> original_prompt_text</span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>      <span class="cf">if</span> (add_instruction_to_prompt) {</span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a>        new_prompt_text <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a>          <span class="st">&quot;{new_prompt_text}</span></span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a><span class="st">          You must answer with only an integer (use no other characters).&quot;</span></span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>        )</span>
<span id="cb46-19"><a href="#cb46-19" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(min) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(max)) {</span>
<span id="cb46-21"><a href="#cb46-21" tabindex="-1"></a>          new_prompt_text <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-22"><a href="#cb46-22" tabindex="-1"></a>            <span class="st">&quot;{new_prompt_text}</span></span>
<span id="cb46-23"><a href="#cb46-23" tabindex="-1"></a><span class="st">            Enter an integer between {min} and {max}.&quot;</span></span>
<span id="cb46-24"><a href="#cb46-24" tabindex="-1"></a>          )</span>
<span id="cb46-25"><a href="#cb46-25" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(min)) {</span>
<span id="cb46-26"><a href="#cb46-26" tabindex="-1"></a>          new_prompt_text <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-27"><a href="#cb46-27" tabindex="-1"></a>            <span class="st">&quot;{new_prompt_text}</span></span>
<span id="cb46-28"><a href="#cb46-28" tabindex="-1"></a><span class="st">            Enter an integer greater than or equal to {min}.&quot;</span></span>
<span id="cb46-29"><a href="#cb46-29" tabindex="-1"></a>          )</span>
<span id="cb46-30"><a href="#cb46-30" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(max)) {</span>
<span id="cb46-31"><a href="#cb46-31" tabindex="-1"></a>          new_prompt_text <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-32"><a href="#cb46-32" tabindex="-1"></a>            <span class="st">&quot;{new_prompt_text}</span></span>
<span id="cb46-33"><a href="#cb46-33" tabindex="-1"></a><span class="st">            Enter an integer less than or equal to {max}.&quot;</span></span>
<span id="cb46-34"><a href="#cb46-34" tabindex="-1"></a>          )</span>
<span id="cb46-35"><a href="#cb46-35" tabindex="-1"></a>        }</span>
<span id="cb46-36"><a href="#cb46-36" tabindex="-1"></a>      }</span>
<span id="cb46-37"><a href="#cb46-37" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" tabindex="-1"></a>      <span class="fu">return</span>(new_prompt_text)</span>
<span id="cb46-39"><a href="#cb46-39" tabindex="-1"></a>    },</span>
<span id="cb46-40"><a href="#cb46-40" tabindex="-1"></a>    </span>
<span id="cb46-41"><a href="#cb46-41" tabindex="-1"></a>    <span class="at">extraction_functions =</span> <span class="fu">list</span>(</span>
<span id="cb46-42"><a href="#cb46-42" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb46-43"><a href="#cb46-43" tabindex="-1"></a>        extracted <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.integer</span>(x))</span>
<span id="cb46-44"><a href="#cb46-44" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(extracted)) {</span>
<span id="cb46-45"><a href="#cb46-45" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">create_llm_feedback</span>(<span class="st">&quot;You must answer with only an integer (use no other characters).&quot;</span>))</span>
<span id="cb46-46"><a href="#cb46-46" tabindex="-1"></a>        }</span>
<span id="cb46-47"><a href="#cb46-47" tabindex="-1"></a>        <span class="fu">return</span>(extracted)</span>
<span id="cb46-48"><a href="#cb46-48" tabindex="-1"></a>      }</span>
<span id="cb46-49"><a href="#cb46-49" tabindex="-1"></a>    ),</span>
<span id="cb46-50"><a href="#cb46-50" tabindex="-1"></a>    </span>
<span id="cb46-51"><a href="#cb46-51" tabindex="-1"></a>    <span class="at">validation_functions =</span> <span class="fu">list</span>(</span>
<span id="cb46-52"><a href="#cb46-52" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb46-53"><a href="#cb46-53" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(min) <span class="sc">&amp;&amp;</span> x <span class="sc">&lt;</span> min) {</span>
<span id="cb46-54"><a href="#cb46-54" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">create_llm_feedback</span>(glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-55"><a href="#cb46-55" tabindex="-1"></a>            <span class="st">&quot;The number should be greater than or equal to {min}.&quot;</span></span>
<span id="cb46-56"><a href="#cb46-56" tabindex="-1"></a>          )))</span>
<span id="cb46-57"><a href="#cb46-57" tabindex="-1"></a>        }</span>
<span id="cb46-58"><a href="#cb46-58" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(max) <span class="sc">&amp;&amp;</span> x <span class="sc">&gt;</span> max) {</span>
<span id="cb46-59"><a href="#cb46-59" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">create_llm_feedback</span>(glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-60"><a href="#cb46-60" tabindex="-1"></a>            <span class="st">&quot;The number should be less than or equal to {max}.&quot;</span></span>
<span id="cb46-61"><a href="#cb46-61" tabindex="-1"></a>          )))</span>
<span id="cb46-62"><a href="#cb46-62" tabindex="-1"></a>        }</span>
<span id="cb46-63"><a href="#cb46-63" tabindex="-1"></a></span>
<span id="cb46-64"><a href="#cb46-64" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb46-65"><a href="#cb46-65" tabindex="-1"></a>      }</span>
<span id="cb46-66"><a href="#cb46-66" tabindex="-1"></a>    )</span>
<span id="cb46-67"><a href="#cb46-67" tabindex="-1"></a>  )</span>
<span id="cb46-68"><a href="#cb46-68" tabindex="-1"></a></span>
<span id="cb46-69"><a href="#cb46-69" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(prompt_list, <span class="fu">list</span>(new_wrap)))</span>
<span id="cb46-70"><a href="#cb46-70" tabindex="-1"></a>}</span></code></pre></div>
<p>They key difference between an extraction and validation function is
that an extraction function alters the LLM’s response and passes on the
altered response to next extraction and/or validation functions, and
eventually to the return statement of send_prompt (if extractions and
validations are succesful). A validation function, on the other hand,
only checks if the LLM’s response passes a logical test. Both extraction
and validation functions can return feedback to the LLM.</p>
<p>For more information, on what you can do with prompt wrappers, see
the documentation of the <code>prompt_wrap</code> class creator
function: <code>create_prompt_wrap</code>. For examples of prompt
wrapper functions, see, for instance the documentation and source code
of <code>add_text</code>, <code>answer_as_integer</code>,
<code>set_mode_chainofthought</code>, and <code>add_tools</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
